---
title: |
      ![](Logo_UCO.png){width="10%"}
       Proyecto final de Computación 
subtitle: "Spider Labs Gifts"
author: "Beatriz Hidalgo,
         Pablo Jiménez y 
         Ángela Delgado"
date: "`r Sys.Date()`"
output: 
    html_document:
      theme: default
      css: estilo.css
      toc: true
      number_sections: true
link-citations: true
urlcolor: "red"
linkcolor: "red"
bibliography: referencias.bib
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# INTRODUCCIÓN

La araña pisaura europea o araña ladrona (*Pisaura mirabilis*) es una especie de araña de la familia de los pisáuridos. El macho de esta especie ofrece regalos de alimentos a las posibles compañeras.

Para ello, el macho captura una presa (generalmente un insecto) y la envuelve **cuidadosamente en seda**. Este regalo nupcial es clave para el éxito reproductivo, ya que:\
**- Reduce la agresividad de la hembra.**\
**- Aumenta la probabilidad de cópula.**\
**- Prolonga la duración de la transferencia de esperma.**\

Además, el tamaño del regalo nupcial puede correlacionarse con ciertos rasgos de personalidad, como las habilidades de lucha o caza del macho.

En algunos casos, machos de menor calidad pueden **engañar**, envolviendo presas de bajo valor nutritivo o incluso restos no comestibles. Esto lo hacen para ahorrar esfuerzo aunque existe el riesgo de que la hembra lo descubra y no acepte el regalo . Para evitarlo, los machos envuelven los regalos en muchas capas adicionales de seda, para poder aparearse antes de que la hembra los desenvuelva por completo y descubra lo que hay dentro.

# METODOLOGÍA

En cada experimento, se colocaron arañas macho de aproximadamente la misma edad en pequeñas cajas que previamente habían contenido arañas hembra sexualmente receptivas, para inducirles a pensar que debían preparar un regalo. Los experimentadores proporcionaron a los machos una ninfa de grillo viva cerca, que presumiblemente podrían usar como regalo. Si el macho no la atrapaba en veinte minutos, o la atrapaba pero no hacía un regalo con ella, el experimento finaliza y se reiniciaba al día siguiente.

Se midió el peso de la presa antes y después de convertirla en regalo, para ver si el macho comía algo antes de envolverla. También se registró el peso de la seda utilizada para envolver la presa.

Para llevar a cabo el análisis usamos R [@R-base] con las librerias dplyr [@R-dplyr] y ggplot [@R-ggplot2; @ggplot22016]. Para la creación del informe hemos utilizado el paquete knitr [@R-knitr; @knitr2015; @knitr2014] y pandoc.

# HIPÓTESIS

Para nuestro proyecto vamos a proponer tres hipotesis::

-   **Hipotesis 1:** Efecto del tratamiento sobre el consumo previo del regalo.

    -   H₀: No exiten diferencias en el consumo previo del regalo entre tratamientos.

    -   H₁: Existen diferencias entre el consumo previo del regalo entre tratamientos.

-   **Hipótesis 2:** Relación entre el peso del macho y el peso del regalo.

    -   H₀: No exite relación significativa entre el peso del macho y el peso del regalo.

    -   H₁: Existe relación significativa entre el peso del macho y el peso del regalo.

-   **Hipótesis 3:** Relación entre la inversión temporal y el consumo previo del regalo.

    -   H₀: No exite relación significativa entre la inversión temporal y el consumo previo del regalo.

    -   H₁: Exite relación significativa entre la inversión temporal y el consumo previo del regalo.

# BASE DE DATOS

<!-- Cargamos las librerías -->

```{r cargar-librerias, echo=FALSE, warning=FALSE, message=FALSE}
library('dplyr')
library('ggplot2')
library('knitr')
```

<!-- Cargamos los datos -->

```{r leer-archivo, echo=FALSE, warning=FALSE, results='hide'}
library(readr)

datos <- read.csv("C:/Users/Ángela/OneDrive/Escritorio/proyecto2/spider-lab-gifts.csv", sep = ",", dec = ".")
colnames(datos)
View(datos)
```

Estos datos fueron obtenidos en <https://www.kaggle.com/datasets/mexwell/spider-lab-gifts>

Los datos tienen `r nrow(datos)` filas y `r ncol(datos)` columnas.

Cada fila corresponde a un macho distinto, por lo que en este caso tenemos una muestra formada por `r nrow(datos)` machos.

Cada columna corresponde con una variable. Aunque tenemos `r ncol(datos)` variables en nuestra base de datos para analizar nuestras hipotesis no las necesitamos todad y hemos seleccionado las siguientes:

-   **MALE ID** ID única que nos sirve para identificar a los machos.

-   **FOOD TREATMENT:** dieta que reciven los machos.

    -   LF: un insecto por semana.

    -   WF: dos insectos por semana.

-   **Gift weight (mg):** peso del regalo producido en miligramos.

-   **MALE MASS BEFORE TRIAL (mg):** la masa del macho al principio del experimento en miligramos.

-   **MALE MASS AFTER TRIAL (mg):** masa del macho despues de hacer el regalo en miligramos. Esta variable nos permite ver si el macho se ha alimentado del regalo antes de envolverlo.

-   **MALE WEIGHT difference (bef-after):** diferencia de peso del macho antes y despues de hacer el regalo.

```{r datos procesados, echo=FALSE, warning=FALSE, results='hide'}
#Calculamos el consumo previo
datos <- datos %>%
  mutate(consumo_previo =  MALE.MASS.AFTER.TRIAL..mg. -
           MALE.MASS.BEFORE.TRIAL..mg.)
# Selecciono las columnas
datos <- datos %>%
  select(MALE.ID, FOOD.TREATMENT, N.TRIAL, MALE.MASS.BEFORE.TRIAL..mg., MALE.MASS.AFTER.TRIAL..mg.,  Gift.weight..mg., consumo_previo)

#Elimino los datos perdidos (NA)
datos_sin_NA <- na.omit(datos)
```

```{r tabla, echo=FALSE, warning=FALSE, }
knitr::kable(head(datos_sin_NA, 8), align = 'c', caption = "Tabla 1: Ocho primeras filas base datos")
```

# ANÁLISIS

## Hipotesis 1

-   H₀: No existen diferencias en consumo previo del regalo entre los dos tratamiento.

-   H₁: Existen diferencias en el consumo previo del regalo entre los dos tratamiento.

```{r convertir variable a factor, echo=FALSE, warning=FALSE, results='hide'}
#Antes de hacer el analisis debemos asegurarnos si nuestra variable FOOD TREATMENT en un factor con dos niveles
# Convertir FOOD.TREATMENT a factor
datos$FOOD.TREATMENT <- as.factor(datos $FOOD.TREATMENT)

# Comprobar niveles
levels(datos$FOOD.TREATMENT)
```

Para ello vamos a realizar un analisis t-test.

```{r t-student, echo=FALSE, warning=FALSE}
FT_by_PWL <- t.test(consumo_previo ~ FOOD.TREATMENT,
                    data = datos)

print(FT_by_PWL)

```

Si observamos los resultados, vemos que el valor de p\>0.05. Esto quiere decir que debemos rechazar la hipotesis alternativa y aceptar la nula, es decir, no van a existir diferencias en cuanto al tratamiento con respecto al consumo previo del regalo.

```{r gráfico, echo=FALSE, warning=FALSE}
grafico <- datos %>% 
  ggplot(aes(x = FOOD.TREATMENT, y = consumo_previo, color = FOOD.TREATMENT)) + 
  geom_boxplot(show.legend = FALSE, outlier.shape = NA) + 
  geom_jitter(width = 0.3, alpha = 0.4) + 
  labs(x = "", y = "Diferencia del peso del macho") +
  theme(legend.position = "none")

grafico
```

## Hipotesis 2

-   H₀: No existe relación entre el tamaño corporal y el peso del regalo.

-   H₁: Existe una relación positiva entre el tamaño corporal y el peso del regalo.

Realizamos un análisis descriptivo.

```{r , echo=FALSE, warning=FALSE}
summary(datos$`Gift.weight..mg.`)
```

A continuación comprobamos la normalidad:

```{r, echo=FALSE, warning=FALSE}
modelo2 <- lm(`MALE.MASS.BEFORE.TRIAL..mg.` ~ `Gift.weight..mg.`, data = datos)
modelo2
res2 <- residuals(modelo2)

hist(res2, main = "Histograma de residuos", xlab = "Residuos")
qqnorm(res2)
qqline(res2)
shapiro.test(res2)#p-valor > 0,05 por lo que los residuos y a su vez la distribución es normal.

nobs(modelo2)
```

Por último, realizamos un análisis de correlación de Pearson entre el tamaño del macho y el peso del regalo.

```{r, echo=FALSE, warning=FALSE }
cor.test(datos$`MALE.MASS.BEFORE.TRIAL..mg.`,
         datos$`Gift.weight..mg.`,
         method = "pearson",
         use = "complete.obs")

```

A su vez, el p-valor es \<0,05 por lo que tenemos que rechazar la hipotesis nula y aceptar la hipotesis alternativa, es decir, que exite una relación significativa entre el peso del macho y el peso del regalo. Ademas de esto, la correlación es positiva por lo que indica que a mayor peso corporal, mayor peso del regalo.

```{r Gafico puntos, echo=FALSE, warning=FALSE}
ggplot(datos, aes(
  x = `MALE.MASS.BEFORE.TRIAL..mg.`,
  y = `Gift.weight..mg.`
)) +
  geom_point(size = 2, alpha = 0.7) +
  geom_smooth(method = "lm", se = TRUE) +
  theme_classic() +
  labs(
    x = "Masa del macho después del ensayo (mg)",
    y = "Peso del regalo (mg)",
    title = "Relación entre la masa del macho y el peso del regalo"
  )
```

## Hipotesis 3

H₀: No existe una relación significativa entre la inversión del macho para conseguir el regalo y el consumo del regalo.

H₁: Existe una relación significativa entre la inversión del macho para conseguir el regalo y el consumo del regalo.

Para ver si existe relacion entre estas dos variables vamos a realizar una regresión lineal.

```{r regresiónlineal_WF , echo=FALSE, warning=FALSE}
modelo_TR <- lm(consumo_previo ~ N.TRIAL, data = datos)
summary(modelo_TR)
```

El **p-valor es \>0,05** por lo que aceptamos la hipótesis nula, es decir, si que no existe una relación significativa entre el tiempo invertido por el macho en conseguir el regalo y el consumo previo.

```{r grafico_WF, echo=FALSE, warning=FALSE}

ggplot(datos, aes(x = N.TRIAL, y = consumo_previo)) +
  geom_jitter(width = 0.1, height = 0) +
  geom_smooth(method = "lm", se = TRUE) +
  labs(x = "Número de intentos de captura",
       y = "Consumo previo de la presa")
```

# CONCLUSIONES

De cada una de las hipotesis podemos sacar diferentes conclusiones:

-   Los machos de ambos tratamientos consumen el regalo independientemente de su alimentación. Esto nos podria indicar que existen otros factores que influyan en el que el macho se alimente previamente del regalo antes de envolverlo.

-   Que machos con un mayor peso corporal sean capaces de capturar regalos de mayor peso nos indica que sus aptitudes físicas son mejores, y por lo tanto va a poder capturar regalos más grande paara ofrecerle a la hembra.

-   El hecho de que los machos , a pesar de invertir mucho tiempo en conseguir el regalo sigan consumiendo parte de el nos puede indicar que los machos anteponen sus supervivencia para así volver a tener la oportunidad de reproducirse.

# BIBLIOGRAFÍA

Beyer et al. @beyer2025 analizan la variación conductual individual.
